services:
  # 1) Managed PostgreSQL Database
  - type: pserv
    name: postgres-db
    env: postgres
    plan: free
    autoDeploy: false

  # 2) FastAPI App (Docker)
  - type: web
    name: fastapi-db-api
    env: docker
    plan: free
    dockerfilePath: Dockerfile
    dockerContext: .
    healthCheckPath: /tables
    envVars:
      - key: DATABASE_URL
        fromService:
          type: pserv
          name: postgres-db
          property: connectionString
      - key: CONNECT_API_KEY
        sync: false
